<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Logout Test - STMNPBDG.US</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
      <h1 class="text-3xl font-bold mb-8 text-center">Logout System Test</h1>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
        <!-- Current Status -->
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h2 class="text-xl font-semibold mb-4">Current Login Status</h2>
          <div id="status" class="text-sm text-gray-600">
            Checking login status...
          </div>
          <button
            onclick="checkStatus()"
            class="mt-4 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
          >
            Refresh Status
          </button>
        </div>

        <!-- Test Actions -->
        <div class="bg-white p-6 rounded-lg shadow-md">
          <h2 class="text-xl font-semibold mb-4">Test Logout Actions</h2>
          <div class="space-y-3">
            <button
              onclick="testLogin()"
              class="w-full bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600"
            >
              1. Login First (admin@test.com / 123)
            </button>
            <button
              onclick="testLogout()"
              class="w-full bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600"
            >
              2. Test Logout Function
            </button>
            <button
              onclick="simulateDropdownLogout()"
              class="w-full bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600"
            >
              3. Simulate Dropdown Logout Click
            </button>
            <button
              onclick="clearAll()"
              class="w-full bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600"
            >
              Clear All Data
            </button>
          </div>
        </div>

        <!-- How Logout Works -->
        <div class="bg-white p-6 rounded-lg shadow-md md:col-span-2">
          <h2 class="text-xl font-semibold mb-4">How Logout Works</h2>
          <div class="bg-blue-50 p-4 rounded-lg">
            <h3 class="font-semibold mb-2">Logout Process:</h3>
            <ol class="list-decimal list-inside space-y-1 text-sm">
              <li>User clicks logout button in dropdown menu</li>
              <li>Confirmation dialog appears: "Yakin ingin logout?"</li>
              <li>If user clicks OK, localStorage "currentUser" is removed</li>
              <li>Alert shows: "Anda telah logout"</li>
              <li>Page reloads automatically</li>
              <li>User button changes back to login link</li>
            </ol>
          </div>

          <div class="mt-4 bg-green-50 p-4 rounded-lg">
            <h3 class="font-semibold mb-2">Logout Function Code:</h3>
            <pre
              class="text-xs bg-gray-100 p-2 rounded overflow-x-auto"
            ><code>function handleLogout() {
  if (confirm("Yakin ingin logout?")) {
    localStorage.removeItem("currentUser");
    alert("Anda telah logout");
    window.location.href = window.location.href; // Reload
  }
}</code></pre>
          </div>
        </div>

        <!-- Test Real Pages -->
        <div class="bg-white p-6 rounded-lg shadow-md md:col-span-2">
          <h2 class="text-xl font-semibold mb-4">Test on Real Pages</h2>
          <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <a
              href="index.html"
              class="bg-gray-500 text-white px-4 py-2 rounded text-center hover:bg-gray-600"
              >Home</a
            >
            <a
              href="pages/menu/shop.html"
              class="bg-gray-500 text-white px-4 py-2 rounded text-center hover:bg-gray-600"
              >Shop</a
            >
            <a
              href="pages/profile/cart.html"
              class="bg-gray-500 text-white px-4 py-2 rounded text-center hover:bg-gray-600"
              >Cart</a
            >
            <a
              href="pages/payment/checkout.html"
              class="bg-gray-500 text-white px-4 py-2 rounded text-center hover:bg-gray-600"
              >Checkout</a
            >
          </div>
          <p class="text-sm text-gray-600 mt-2">
            <strong>Instructions:</strong> Login first, then visit any page
            above and click the user button (üë§) to see dropdown with logout
            option.
          </p>
        </div>
      </div>
    </div>

    <script>
      // Import main.js functions for testing
      function checkStatus() {
        const currentUser = JSON.parse(localStorage.getItem("currentUser"));
        const usersDB = JSON.parse(localStorage.getItem("usersDB")) || [];

        let status = "<strong>Login Status:</strong> ";
        if (currentUser) {
          status += `‚úÖ Logged in as ${currentUser.name || currentUser.email}<br>`;
          status += `<strong>User Info:</strong> ${JSON.stringify(currentUser, null, 2)}<br>`;
        } else {
          status += "‚ùå Not logged in<br>";
        }

        status += `<strong>Users DB:</strong> ${usersDB.length} users registered<br>`;
        status += `<strong>Current Path:</strong> ${window.location.pathname}<br>`;

        document.getElementById("status").innerHTML = status;
      }

      function testLogin() {
        const testUser = { name: "Test Admin", email: "admin@test.com" };
        localStorage.setItem("currentUser", JSON.stringify(testUser));
        alert("Login successful! User set to: " + testUser.name);
        checkStatus();
      }

      function testLogout() {
        // Simulate the handleLogout function
        if (confirm("Yakin ingin logout?")) {
          localStorage.removeItem("currentUser");
          alert("Anda telah logout");
          checkStatus();
        }
      }

      function simulateDropdownLogout() {
        // Simulate clicking logout from dropdown
        alert(
          "This would normally be called from the dropdown logout button.\n\nSimulating logout process...",
        );
        testLogout();
      }

      function clearAll() {
        if (confirm("Clear all localStorage data?")) {
          localStorage.clear();
          alert("All data cleared!");
          checkStatus();
        }
      }

      // Check status on load
      window.onload = checkStatus;
    </script>
  </body>
</html>
