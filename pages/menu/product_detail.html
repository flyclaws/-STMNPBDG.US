<!doctype html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Detail - STMNPBDG.US</title>

    <!-- CDN untuk Styling & Icon -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "Roboto", sans-serif;
      }
      .bg-custom-green {
        background-color: #263529;
      }
      .text-custom-gold {
        color: #b6a176;
      }
      .border-custom-gold {
        border-color: #b6a176;
      }
      .hover-line-menu {
        position: relative;
        display: inline-block;
        padding: 0.5rem 0;
      }

      /* Menghilangkan panah di input number */
      input[type="number"]::-webkit-inner-spin-button,
      input[type="number"]::-webkit-outer-spin-button {
        -webkit-appearance: none;
        margin: 0;
      }

      /* Custom Scrollbar untuk Deskripsi */
      .custom-scrollbar::-webkit-scrollbar {
        width: 3px;
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background-color: #d1d5db;
        border-radius: 4px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background-color: transparent;
      }
    </style>
  </head>
  <!-- KUNCI LAYAR: h-screen & overflow-hidden -->
  <body
    class="bg-white m-0 p-0 h-screen overflow-hidden flex flex-col font-sans text-gray-900"
  >
    <!-- ===================== SIDEBAR MENU ===================== -->
    <div
      id="sidebar"
      class="fixed inset-y-0 left-0 w-64 bg-white z-[60] transform -translate-x-full transition-transform duration-300 ease-in-out shadow-2xl"
    >
      <div class="p-6">
        <button
          onclick="toggleMenu()"
          class="bg-custom-green text-custom-gold w-10 h-10 rounded flex items-center justify-center mb-12 hover:opacity-90 transition shadow-sm"
        >
          <i class="fas fa-bars text-xl"></i>
        </button>
        <ul
          class="flex flex-col gap-6 text-black font-extrabold tracking-wide text-sm md:text-base"
        >
          <li>
            <a href="shop.html" class="hover-line-menu group"
              >SHOP<span
                class="absolute bottom-0 left-0 w-full h-[2px] bg-black scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-center"
              ></span
            ></a>
          </li>
          <li>
            <a href="collection.html" class="hover-line-menu group"
              >COLLECTION<span
                class="absolute bottom-0 left-0 w-full h-[2px] bg-black scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-center"
              ></span
            ></a>
          </li>
          <li>
            <a href="lookbook.html" class="hover-line-menu group"
              >LOOKBOOK<span
                class="absolute bottom-0 left-0 w-full h-[2px] bg-black scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-center"
              ></span
            ></a>
          </li>
          <li>
            <a href="about_us.html" class="hover-line-menu group"
              >ABOUT US<span
                class="absolute bottom-0 left-0 w-full h-[2px] bg-black scale-x-0 group-hover:scale-x-100 transition-transform duration-300 origin-center"
              ></span
            ></a>
          </li>
        </ul>
      </div>
    </div>
    <div
      id="overlay"
      onclick="toggleMenu()"
      class="fixed inset-0 bg-black/50 z-[55] hidden transition-opacity duration-300 opacity-0 backdrop-blur-sm"
    ></div>

    <!-- ===================== HEADER ===================== -->
    <nav
      class="w-full z-50 bg-custom-green text-white px-4 py-4 md:px-8 flex justify-between items-center shadow-md flex-none h-16 md:h-20"
    >
      <button
        onclick="toggleMenu()"
        class="text-xl md:text-2xl opacity-80 hover:opacity-100 transition focus:outline-none"
      >
        <i class="fas fa-bars"></i>
      </button>
      <a
        href="../../index.html"
        class="text-sm md:text-lg font-bold tracking-widest uppercase flex items-center gap-2 hover:opacity-80 transition cursor-pointer"
        ><i class="fas fa-leaf text-xs opacity-80"></i> STMNPBDG.US</a
      >
      <div class="flex gap-4 md:gap-6 items-center">
        <a
          href="../profile/cart.html"
          class="text-lg md:text-xl opacity-80 hover:opacity-100 transition text-white"
          ><i class="fas fa-shopping-cart"></i
        ></a>
        <div class="relative">
          <button
            data-user-button
            class="text-lg md:text-xl opacity-80 hover:opacity-100 transition text-custom-gold"
          >
            <i class="fas fa-user-circle"></i>
          </button>
          <!-- User Dropdown Menu (hanya muncul saat login) -->
          <div
            id="userDropdown"
            class="hidden absolute right-0 mt-2 w-48 bg-white text-gray-800 rounded-lg shadow-lg z-50"
          >
            <div id="userDropdownContent" class="p-4">
              <!-- Dinamis berdasarkan login status -->
            </div>
          </div>
        </div>
      </div>
    </nav>

    <!-- ===================== MAIN CONTENT ===================== -->
    <main
      class="w-full px-6 md:px-12 flex-grow flex flex-col justify-center items-center overflow-hidden"
    >
      <div
        class="max-w-[1200px] w-full h-full max-h-[85vh] flex flex-col pt-4 pb-2"
      >
        <!-- Header Judul & Back -->
        <div class="flex justify-between items-center mb-4 flex-none">
          <a
            href="shop.html"
            class="inline-flex items-center gap-2 text-[10px] md:text-xs font-bold text-gray-500 hover:text-black transition"
          >
            <i class="fas fa-arrow-left"></i> Back
          </a>
          <h1
            class="text-xl md:text-2xl font-extrabold tracking-wide text-black absolute left-1/2 transform -translate-x-1/2"
          >
            Product Detail
          </h1>
          <div class="w-10"></div>
        </div>

        <!-- GRID 2 KOLOM -->
        <div
          class="flex-grow grid grid-cols-1 md:grid-cols-2 gap-8 md:gap-12 items-stretch min-h-0"
        >
          <!-- KOLOM KIRI: FOTO -->
          <div class="flex flex-col gap-3 h-full overflow-hidden">
            <div
              class="w-full flex-grow bg-gray-100 rounded-xl overflow-hidden shadow-sm relative group min-h-0"
            >
              <img
                id="main-image"
                src=""
                alt="Product"
                class="w-full h-full object-cover transition duration-300 group-hover:scale-105"
              />
            </div>
            <div
              id="thumbnail-container"
              class="grid grid-cols-4 gap-2 h-20 md:h-24 flex-none"
            ></div>
          </div>

          <!-- KOLOM KANAN: INFO -->
          <div class="flex flex-col h-full justify-between overflow-hidden">
            <div class="flex-none pb-3 border-b border-gray-100">
              <span
                id="p-category"
                class="bg-[#B6A176] text-white text-[9px] font-bold px-2 py-0.5 rounded-full uppercase tracking-wide"
                >Category</span
              >
              <h2
                id="p-name"
                class="text-lg md:text-2xl font-extrabold mt-1 text-black leading-tight"
              >
                Loading...
              </h2>
              <p
                id="p-price"
                class="text-base md:text-lg font-bold mt-0.5 text-gray-700"
              >
                -
              </p>
            </div>

            <div class="flex-grow overflow-y-auto custom-scrollbar py-3 pr-2">
              <!-- Deskripsi -->
              <h3 class="font-bold text-xs mb-0.5">Deskripsi</h3>
              <p
                id="p-desc"
                class="text-[9px] md:text-xs text-gray-600 leading-relaxed text-justify mb-3"
              >
                Sedang memuat data...
              </p>

              <!-- Pilihan Ukuran -->
              <div class="mt-2">
                <h3 class="font-bold text-[10px] mb-1">
                  Pilih Ukuran
                  <span
                    id="size-warning"
                    class="text-red-500 font-normal hidden"
                    >(Wajib dipilih)</span
                  >
                </h3>
                <div class="flex flex-wrap gap-1.5" id="size-container">
                  <button
                    data-size="S"
                    onclick="selectSize('S', this)"
                    class="size-btn border border-gray-300 text-[9px] md:text-[10px] px-3 py-1 rounded hover:bg-black hover:text-white transition"
                  >
                    S
                  </button>
                  <button
                    data-size="M"
                    onclick="selectSize('M', this)"
                    class="size-btn border border-gray-300 text-[9px] md:text-[10px] px-3 py-1 rounded hover:bg-black hover:text-white transition"
                  >
                    M
                  </button>
                  <button
                    data-size="L"
                    onclick="selectSize('L', this)"
                    class="size-btn border border-gray-300 text-[9px] md:text-[10px] px-3 py-1 rounded hover:bg-black hover:text-white transition"
                  >
                    L
                  </button>
                  <button
                    data-size="XL"
                    onclick="selectSize('XL', this)"
                    class="size-btn border border-gray-300 text-[9px] md:text-[10px] px-3 py-1 rounded hover:bg-black hover:text-white transition"
                  >
                    XL
                  </button>
                </div>
              </div>

              <!-- Stock Status -->
              <div
                id="stock-status"
                class="hidden mt-3 p-2 bg-red-100 rounded border border-red-300"
              ></div>

              <!-- Jumlah -->
              <div class="mt-3">
                <h3 class="font-bold text-[10px] mb-1">Jumlah</h3>
                <div
                  class="flex items-center gap-1 bg-gray-100 rounded-lg px-2 py-1 w-fit"
                >
                  <button
                    onclick="updateQty(-1)"
                    class="w-5 h-5 flex items-center justify-center font-bold text-xs hover:text-[#263529]"
                  >
                    -
                  </button>
                  <input
                    id="qty"
                    type="number"
                    value="1"
                    class="w-6 text-center border-none bg-transparent text-xs"
                    readonly
                  />
                  <button
                    onclick="updateQty(1)"
                    class="w-5 h-5 flex items-center justify-center font-bold text-xs hover:text-[#263529]"
                  >
                    +
                  </button>
                </div>
              </div>
            </div>

            <!-- Bagian BAWAH (Hanya Tombol Beli) -->
            <div class="flex-none pt-3 border-t border-gray-100">
              <button
                id="add-to-bag-btn"
                onclick="addToBag()"
                class="w-full bg-[#263529] text-white font-bold py-2.5 rounded-lg hover:opacity-90 transition shadow-md text-xs md:text-sm flex items-center justify-center gap-2"
              >
                <i class="fas fa-shopping-bag"></i> Add To Bag
              </button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- FOOTER -->
    <footer
      class="bg-custom-green text-custom-gold py-3 px-6 flex-none z-10 w-full text-center"
    >
      <div class="text-[10px] md:text-xs italic">
        &copy; 2025 | stmnpbdg.us x dekavein.studios x it.parmad â€” Crafted with
        passion. All rights reserved.
      </div>
    </footer>

    <!-- SCRIPT & DATA -->
    <script>
      // --- 1. DATA PRODUK (DATABASE) ---
      const productsDB = {
        hoodie_black: {
          name: "Signature Hoodie - Black",
          category: "Collection Q1",
          price: 350000,
          desc: "Hoodie hitam premium dengan bahan Cotton Fleece 330gsm yang tebal namun adem. Dilengkapi dengan sablon Plastisol High Density.",
          mainImage: "../../asset/images/shop/hoddy.jpg",
          sizes: { S: 5, M: 8, L: 3, XL: 0 },
          thumbnails: [
            "../../asset/images/shop/hoddy.jpg",
            "../../asset/images/shop/hoddy.jpg",
            "../../asset/images/shop/hoddy.jpg",
            "../../asset/images/shop/hoddy.jpg",
          ],
        },
        tshirt_white: {
          name: "Basic Logo Tee - White",
          category: "Collection Q1",
          price: 150000,
          desc: "Kaos putih bersih berbahan Cotton Combed 24s Australia. Sangat lembut di kulit, menyerap keringat, dan tidak menerawang.",
          mainImage: "../../asset/images/shop/kaos.jpg",
          sizes: { S: 12, M: 15, L: 10, XL: 8 },
          thumbnails: [
            "../../asset/images/shop/kaos.jpg",
            "../../asset/images/shop/kaos 2.jpg",
            "../../asset/images/shop/kaos3.jpg",
            "../../asset/images/shop/hoddy.jpg",
          ],
        },
        totebag_canvas: {
          name: "Daily Canvas Totebag",
          category: "Accessories",
          price: 85000,
          desc: "Totebag berbahan kanvas tebal (Marsoto) yang kuat menampung laptop hingga 14 inch. Dilengkapi resleting dan saku dalam.",
          mainImage: "../../asset/images/shop/tas.jpg",
          sizes: { S: 0, M: 0, L: 2, XL: 2 },
          thumbnails: [
            "../../asset/images/shop/tas.jpg",
            "../../asset/images/shop/tas2.jpg",
            "../../asset/images/shop/pin.jpg",
            "../../asset/images/shop/hoddy.jpg",
          ],
        },
        raya_brown_set: {
          name: "Raya Set - Earthy Brown",
          category: "Collection Q1",
          price: 450000,
          desc: "Setelan Raya dengan warna earthy brown yang elegan. Terbuat dari bahan berkualitas tinggi dengan potongan modern.",
          mainImage: "../../asset/images/shop/DSC04555.jpg",
          sizes: { S: 4, M: 6, L: 5, XL: 3 },
          thumbnails: [
            "../../asset/images/shop/DSC04555.jpg",
            "../../asset/images/shop/hoddy.jpg",
            "../../asset/images/shop/kaos.jpg",
            "../../asset/images/shop/tas.jpg",
          ],
        },
        oxford_shirt: {
          name: "Oxford Shirt - Blue",
          category: "Collection Q2",
          price: 250000,
          desc: "Kemeja oxford berbahan katun berkualitas dengan warna biru klasik. Cocok untuk acara formal maupun kasual.",
          mainImage: "../../asset/images/shop/kaos 2.jpg",
          sizes: { S: 6, M: 10, L: 8, XL: 4 },
          thumbnails: [
            "../../asset/images/shop/kaos 2.jpg",
            "../../asset/images/shop/kaos.jpg",
            "../../asset/images/shop/hoddy.jpg",
            "../../asset/images/shop/jaket.jpg",
          ],
        },
        winter_coat: {
          name: "Winter Coat - Charcoal",
          category: "Collection Q4",
          price: 550000,
          desc: "Jaket musim dingin dengan bahan tebal dan hangat. Warna charcoal yang netral dan mudah dipadukan.",
          mainImage: "../../asset/images/shop/jaket.jpg",
          sizes: { S: 2, M: 3, L: 1, XL: 0 },
          thumbnails: [
            "../../asset/images/shop/jaket.jpg",
            "../../asset/images/shop/hoddy.jpg",
            "../../asset/images/shop/hoddy2.jpg",
            "../../asset/images/shop/topi.jpg",
          ],
        },
        cap_black: {
          name: "Baseball Cap - Black",
          category: "Collection Q3",
          price: 75000,
          desc: "Topi baseball dengan bahan berkualitas dan desain klasik. Warna hitam yang cocok untuk semua outfit.",
          mainImage: "../../asset/images/shop/topi.jpg",
          sizes: { S: 20, M: 25, L: 18, XL: 15 },
          thumbnails: [
            "../../asset/images/shop/topi.jpg",
            "../../asset/images/shop/pin.jpg",
            "../../asset/images/shop/pin2.jpg",
            "../../asset/images/shop/stiker.jpg",
          ],
        },
        chino_beige: {
          name: "Chino Pants - Beige",
          category: "Collection Q2",
          price: 300000,
          desc: "Celana chino dengan warna beige yang elegan. Terbuat dari bahan berkualitas dengan potongan slim fit.",
          mainImage: "../../asset/images/shop/kaos3.jpg",
          sizes: { S: 7, M: 9, L: 6, XL: 4 },
          thumbnails: [
            "../../asset/images/shop/kaos3.jpg",
            "../../asset/images/shop/kaos.jpg",
            "../../asset/images/shop/kaos 2.jpg",
            "../../asset/images/shop/hoddy.jpg",
          ],
        },
        scarf_wool: {
          name: "Wool Scarf - Red",
          category: "Collection Q4",
          price: 120000,
          desc: "Syawl wol dengan warna merah yang cerah. Terbuat dari bahan wol berkualitas yang hangat dan nyaman.",
          mainImage: "../../asset/images/shop/stiker.jpg",
          sizes: { S: 0, M: 0, L: 0, XL: 0 },
          thumbnails: [
            "../../asset/images/shop/stiker.jpg",
            "../../asset/images/shop/stiker2.jpg",
            "../../asset/images/shop/stiker3.jpg",
            "../../asset/images/shop/stiker4.jpg",
          ],
        },
        raya_kimono_black: {
          name: "Kimono Top - Black",
          category: "Collection Q1",
          price: 280000,
          desc: "Atasan kimono dengan warna hitam elegan. Desain tradisional yang modern dengan bahan berkualitas.",
          mainImage: "../../asset/images/shop/hoddy2.jpg",
          sizes: { S: 8, M: 12, L: 9, XL: 5 },
          thumbnails: [
            "../../asset/images/shop/hoddy2.jpg",
            "../../asset/images/shop/hoddy.jpg",
            "../../asset/images/shop/jaket.jpg",
            "../../asset/images/shop/tas.jpg",
          ],
        },
        oversized_tee_grey: {
          name: "Oversized Tee - Grey",
          category: "Collection Q1",
          price: 160000,
          desc: "Kaos oversized dengan warna abu-abu. Desain casual yang nyaman untuk sehari-hari.",
          mainImage: "../../asset/images/shop/stiker2.jpg",
          sizes: { S: 11, M: 14, L: 7, XL: 9 },
          thumbnails: [
            "../../asset/images/shop/stiker2.jpg",
            "../../asset/images/shop/stiker.jpg",
            "../../asset/images/shop/stiker3.jpg",
            "../../asset/images/shop/stiker4.jpg",
          ],
        },
        cargo_pants_green: {
          name: "Cargo Pants - Olive",
          category: "Collection Q3",
          price: 320000,
          desc: "Celana cargo dengan warna olive. Banyak kantong dan desain praktis untuk aktivitas sehari-hari.",
          mainImage: "../../asset/images/shop/tas2.jpg",
          sizes: { S: 3, M: 5, L: 4, XL: 2 },
          thumbnails: [
            "../../asset/images/shop/tas2.jpg",
            "../../asset/images/shop/tas.jpg",
            "../../asset/images/shop/pin.jpg",
            "../../asset/images/shop/hoddy.jpg",
          ],
        },
        denim_jacket_blue: {
          name: "Classic Denim Jacket",
          category: "Collection Q2",
          price: 450000,
          desc: "Jaket denim klasik dengan warna biru. Item wardrobe essential yang timeless.",
          mainImage: "../../asset/images/shop/stiker3.jpg",
          sizes: { S: 6, M: 8, L: 5, XL: 3 },
          thumbnails: [
            "../../asset/images/shop/stiker3.jpg",
            "../../asset/images/shop/stiker.jpg",
            "../../asset/images/shop/stiker2.jpg",
            "../../asset/images/shop/stiker4.jpg",
          ],
        },
        flannel_shirt_red: {
          name: "Flannel Shirt - Red Check",
          category: "Collection Q4",
          price: 280000,
          desc: "Kemeja flanel dengan motif kotak-kotak merah. Cocok untuk gaya casual dan musim dingin.",
          mainImage: "../../asset/images/shop/pin.jpg",
          sizes: { S: 10, M: 13, L: 8, XL: 6 },
          thumbnails: [
            "../../asset/images/shop/pin.jpg",
            "../../asset/images/shop/pin2.jpg",
            "../../asset/images/shop/pin3.jpg",
            "../../asset/images/shop/topi.jpg",
          ],
        },
        bucket_hat_cream: {
          name: "Bucket Hat - Cream",
          category: "Collection Q3",
          price: 90000,
          desc: "Topi bucket dengan warna cream. Desain casual yang stylish dan nyaman.",
          mainImage: "../../asset/images/shop/pin2.jpg",
          sizes: { S: 0, M: 0, L: 0, XL: 0 },
          thumbnails: [
            "../../asset/images/shop/pin2.jpg",
            "../../asset/images/shop/pin.jpg",
            "../../asset/images/shop/pin3.jpg",
            "../../asset/images/shop/topi.jpg",
          ],
        },
        socks_pack_white: {
          name: "Crew Socks 3-Pack",
          category: "Collection Q3",
          price: 99000,
          desc: "Paket kaos kaki crew 3 pasang warna putih. Berkualitas tinggi dan nyaman digunakan.",
          mainImage: "../../asset/images/shop/pin3.jpg",
          sizes: { S: 30, M: 35, L: 28, XL: 22 },
          thumbnails: [
            "../../asset/images/shop/pin3.jpg",
            "../../asset/images/shop/pin.jpg",
            "../../asset/images/shop/pin2.jpg",
            "../../asset/images/shop/stiker.jpg",
          ],
        },
        waist_bag_black: {
          name: "Street Waist Bag",
          category: "Collection Q3",
          price: 120000,
          desc: "Tas pinggang jalanan dengan warna hitam. Praktis untuk menyimpan barang-barang penting.",
          mainImage: "../../asset/images/shop/stiker4.jpg",
          sizes: { S: 1, M: 2, L: 1, XL: 0 },
          thumbnails: [
            "../../asset/images/shop/stiker4.jpg",
            "../../asset/images/shop/stiker.jpg",
            "../../asset/images/shop/stiker2.jpg",
            "../../asset/images/shop/stiker3.jpg",
          ],
        },
        coach_jacket_navy: {
          name: "Coach Jacket - Navy",
          category: "Collection Q4",
          price: 380000,
          desc: "Jaket coach dengan warna navy. Desain sporty yang cocok untuk berbagai aktivitas.",
          mainImage: "../../asset/images/shop/hoddy2.jpg",
          sizes: { S: 4, M: 7, L: 5, XL: 2 },
          thumbnails: [
            "../../asset/images/shop/hoddy2.jpg",
            "../../asset/images/shop/hoddy.jpg",
            "../../asset/images/shop/jaket.jpg",
            "../../asset/images/shop/tas.jpg",
          ],
        },
          name: "Produk Tidak Ditemukan",
          category: "-",
          price: 0,
          desc: "Maaf, produk yang Anda cari tidak tersedia. Silakan kembali ke halaman Shop.",
          mainImage: "https://placehold.co/800x1000/cccccc/000000?text=No+Data",
          sizes: { S: 0, M: 0, L: 0, XL: 0 },
          thumbnails: [],
        },
      };

      // --- 2. VARIABEL GLOBAL ---
      let currentProduct = {};
      let currentSize = ""; // Menyimpan ukuran yang dipilih

      // --- 3. LOAD DATA SAAT HALAMAN DIBUKA ---
      window.onload = function () {
        const urlParams = new URLSearchParams(window.location.search);
        const productId = urlParams.get("id");

        // Ambil data dari productsDB
        const product = productsDB[productId] || productsDB["default"];
        currentProduct = product; // Simpan ke global untuk addToBag

        // Hitung total stock
        const totalStock = Object.values(product.sizes || {}).reduce(
          (sum, qty) => sum + qty,
          0,
        );
        const isSoldOut = totalStock === 0;

        // Render ke HTML (PASTIKAN ID ADA DI HTML)
        const elName = document.getElementById("p-name");
        if (elName) elName.innerText = product.name;

        const elCategory = document.getElementById("p-category");
        if (elCategory) elCategory.innerText = product.category;

        const elPrice = document.getElementById("p-price");
        if (elPrice)
          elPrice.innerText = "Rp " + product.price.toLocaleString("id-ID");

        const elDesc = document.getElementById("p-desc");
        if (elDesc) elDesc.innerText = product.desc;

        const elMainImg = document.getElementById("main-image");
        if (elMainImg) {
          elMainImg.src = product.mainImage;
          if (isSoldOut) {
            elMainImg.classList.add("grayscale", "opacity-60");
          }
        }

        // Render Thumbnails
        const thumbContainer = document.getElementById("thumbnail-container");
        if (thumbContainer) {
          thumbContainer.innerHTML = "";
          if (product.thumbnails && product.thumbnails.length > 0) {
            product.thumbnails.forEach((imgUrl, index) => {
              const div = document.createElement("div");
              div.className = `w-full h-full bg-gray-100 rounded-lg overflow-hidden cursor-pointer hover:opacity-80 transition border-2 ${
                index === 0 ? "border-[#263529]" : "border-transparent"
              } hover:border-[#263529]`;

              div.onclick = function () {
                document.getElementById("main-image").src = imgUrl;
                Array.from(thumbContainer.children).forEach((c) => {
                  c.classList.remove("border-[#263529]");
                  c.classList.add("border-transparent");
                });
                this.classList.remove("border-transparent");
                this.classList.add("border-[#263529]");
              };

              div.innerHTML = `<img src="${imgUrl}" class="w-full h-full object-cover">`;
              thumbContainer.appendChild(div);
            });
          }
        }

        // Update Size Buttons dengan Stock Info
        const sizeButtons = document.querySelectorAll(".size-btn");
        sizeButtons.forEach((btn) => {
          const size = btn.getAttribute("data-size");
          const stock =
            product.sizes && product.sizes[size] ? product.sizes[size] : 0;

          if (stock === 0) {
            btn.disabled = true;
            btn.classList.add("opacity-40", "cursor-not-allowed");
            btn.style.pointerEvents = "none";
            btn.textContent = size + " (Habis)";
          } else {
            btn.textContent = size + " (" + stock + ")";
          }
        });

        // Set Max Quantity berdasarkan Total Stock
        const qtyInput = document.getElementById("qty");
        if (qtyInput) {
          qtyInput.max = totalStock;
          if (totalStock <= 1) {
            qtyInput.value = 1;
          }
        }

        // Show/Hide Stock Status
        const stockStatus = document.getElementById("stock-status");
        if (stockStatus) {
          if (isSoldOut) {
            stockStatus.innerHTML =
              '<div class="text-red-600 font-bold text-lg">PRODUK HABIS</div>';
            stockStatus.classList.remove("hidden");

            // Disable add to bag button
            const addBtn = document.getElementById("add-to-bag-btn");
            if (addBtn) {
              addBtn.disabled = true;
              addBtn.classList.add("opacity-50", "cursor-not-allowed");
            }
          } else {
            stockStatus.classList.add("hidden");
          }
        }
      };

      // --- 4. FUNGSI PILIH UKURAN ---
      function selectSize(size, btn) {
        // Cek stock ukuran ini
        const stock =
          currentProduct.sizes && currentProduct.sizes[size]
            ? currentProduct.sizes[size]
            : 0;
        if (stock === 0) {
          alert("Ukuran ini sedang tidak tersedia.");
          return;
        }

        currentSize = size; // Simpan ukuran

        // Sembunyikan pesan warning jika ada
        const warning = document.getElementById("size-warning");
        if (warning) warning.classList.add("hidden");

        // Reset semua tombol ke style default
        const buttons = document.querySelectorAll(".size-btn");
        buttons.forEach((b) => {
          b.className =
            "size-btn border border-gray-300 text-[9px] md:text-[10px] px-3 py-1 rounded hover:bg-black hover:text-white transition cursor-pointer bg-white text-gray-900";
        });

        // Set style tombol yang aktif (Hitam Penuh)
        btn.className =
          "size-btn border border-[#263529] bg-[#263529] text-white text-[9px] md:text-[10px] px-3 py-1 rounded transition cursor-pointer shadow-sm transform scale-105";
      }

      // --- 5. FUNGSI KERANJANG ---
      function addToBag() {
        // Validasi: Cek apakah ukuran sudah dipilih
        if (!currentSize) {
          const warning = document.getElementById("size-warning");
          if (warning) warning.classList.remove("hidden");
          alert("Harap pilih ukuran terlebih dahulu!");
          return;
        }

        const qtyInput = document.getElementById("qty");
        const qty = qtyInput ? parseInt(qtyInput.value) : 1;

        // Validasi: Qty tidak boleh lebih dari stok yang tersedia
        const stockForSize =
          currentProduct.sizes && currentProduct.sizes[currentSize]
            ? currentProduct.sizes[currentSize]
            : 0;

        if (qty > stockForSize) {
          alert(
            `Maaf, stok ${currentSize} hanya ${stockForSize} tersedia. Silakan kurangi jumlah.`,
          );
          return;
        }

        const cartItem = {
          id: new Date().getTime(),
          productId: currentProduct.id || "unknown",
          name: currentProduct.name,
          price: currentProduct.price,
          image: currentProduct.mainImage,
          qty: qty,
          size: currentSize,
          maxQty: stockForSize, // Simpan stok ukuran ini untuk referensi di cart
        };

        let cart = JSON.parse(localStorage.getItem("stmnpbdg_cart")) || [];
        cart.push(cartItem);
        localStorage.setItem("stmnpbdg_cart", JSON.stringify(cart));

        alert(
          `Berhasil masuk keranjang!\nProduk: ${currentProduct.name}\nUkuran: ${currentSize}\nJumlah: ${qty}`,
        );

        // Redirect Aman
        const link = document.createElement("a");
        link.href = "../profile/cart.html";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      }

      function updateQty(change) {
        const qtyInput = document.getElementById("qty");
        if (!qtyInput) return;
        let val = parseInt(qtyInput.value) + change;
        const maxStock = parseInt(qtyInput.max) || 999;

        // Validasi batas minimum dan maksimum
        if (val < 1) val = 1;
        if (val > maxStock) val = maxStock;

        qtyInput.value = val;
      }

      // --- 6. TOGGLE MENU ---
      function toggleMenu() {
        const sidebar = document.getElementById("sidebar");
        const overlay = document.getElementById("overlay");
        if (!sidebar || !overlay) return;

        if (sidebar.classList.contains("-translate-x-full")) {
          sidebar.classList.remove("-translate-x-full");
          overlay.classList.remove("hidden");
          // setTimeout sedikit agar transisi opacity berjalan halus
          setTimeout(() => {
            overlay.classList.remove("opacity-0");
          }, 10);
        } else {
          sidebar.classList.add("-translate-x-full");
          overlay.classList.add("opacity-0");
          setTimeout(() => {
            overlay.classList.add("hidden");
          }, 300);
        }
      }

      // Event listener untuk user button (toggle dropdown)
      document.addEventListener("click", function (event) {
        const userButton = document.querySelector("[data-user-button]");
        const userDropdown = document.getElementById("userDropdown");

        if (userButton && userDropdown) {
          if (userButton.contains(event.target)) {
            userDropdown.classList.toggle("hidden");
          } else if (!userDropdown.contains(event.target)) {
            userDropdown.classList.add("hidden");
          }
        }
      });
    </script>

    <!-- MAIN JS -->
    <script src="../../asset/js/main.js"></script>
  </body>
</html>
